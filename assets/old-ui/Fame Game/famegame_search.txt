<?php
// Copyright 2007 Facebook Corp.  All Rights Reserved. 
// 
// Application: Fame Game
// 

require_once 'facebook.php';
include 'style.php';
include 'functions.php';

$appapikey  = '9572b938db605307265f5986ea78a973';
$appsecret = '9551428858603efdbabceb9a78a42b32';
$facebook = new Facebook($appapikey, $appsecret);
$user_id = $facebook->require_login();

$db_host = localhost;
// Your username for MySQL.
$db_user = db49769;
// Your password for MySQL.
$db_pass = ysaura;
// And your given name for the database.
$db_name = drupal_;

// The database connection.
$con = mysql_connect($db_host, $db_user, $db_pass);
if(!$con) { 
	die("Cannot connect. " . mysql_error());
}
// The database name selection.
$dbselect = mysql_select_db($db_name);
if(!$dbselect) { 
	die("Cannot select database " . mysql_error());
}

print '<div class="logo"><img src="http://thedreamfiles.com/fameimg/famelogo.png"></img></div>';

dailyStats($user_id);
leaderboard($user_id);
navBar($user_id, 1);

print '<div class="songs" id="songcanvas">';

$query = mysql_query("SELECT file, name, artist, album, listenlink, ituneslink FROM fame_songs");
$i = 0;
  ?>
  <script>
  var carouselmax = 5;
  document.getElementById('hearticon_0').addEventListener('mouseover',function(){addHeart('hearticon_0');}, false);
  document.getElementById('hearticon_1').addEventListener('mouseover',function(){addHeart('hearticon_1');}, false);
  document.getElementById('hearticon_2').addEventListener('mouseover',function(){addHeart('hearticon_2');}, false);
  document.getElementById('hearticon_3').addEventListener('mouseover',function(){addHeart('hearticon_3');}, false);
  document.getElementById('hearticon_4').addEventListener('mouseover',function(){addHeart('hearticon_4');}, false);
  document.getElementById('hearticon_5').addEventListener('mouseover',function(){addHeart('hearticon_5');}, false);
  document.getElementById('hearticon_6').addEventListener('mouseover',function(){addHeart('hearticon_6');}, false);
  document.getElementById('hearticon_7').addEventListener('mouseover',function(){addHeart('hearticon_7');}, false);
  document.getElementById('hearticon_8').addEventListener('mouseover',function(){addHeart('hearticon_8');}, false);
  document.getElementById('hearticon_9').addEventListener('mouseover',function(){addHeart('hearticon_9');}, false);
  document.getElementById('hearticon_10').addEventListener('mouseover',function(){addHeart('hearticon_10');}, false);
  document.getElementById('skullicon_0').addEventListener('mouseover',function(){addSkull('skullicon_0');}, false);
  document.getElementById('skullicon_1').addEventListener('mouseover',function(){addSkull('skullicon_1');}, false);
  document.getElementById('skullicon_2').addEventListener('mouseover',function(){addSkull('skullicon_2');}, false);
  document.getElementById('skullicon_3').addEventListener('mouseover',function(){addSkull('skullicon_3');}, false);
  document.getElementById('skullicon_4').addEventListener('mouseover',function(){addSkull('skullicon_4');}, false);
  document.getElementById('skullicon_5').addEventListener('mouseover',function(){addSkull('skullicon_5');}, false);
  document.getElementById('skullicon_6').addEventListener('mouseover',function(){addSkull('skullicon_6');}, false);
  document.getElementById('skullicon_7').addEventListener('mouseover',function(){addSkull('skullicon_7');}, false);
  document.getElementById('skullicon_8').addEventListener('mouseover',function(){addSkull('skullicon_8');}, false);
  document.getElementById('skullicon_9').addEventListener('mouseover',function(){addSkull('skullicon_9');}, false);
  document.getElementById('skullicon_10').addEventListener('mouseover',function(){addSkull('skullicon_10');}, false);
  document.getElementById('hearticon_0').addEventListener('mouseout',function(){removeHeart(0);}, false);
  document.getElementById('hearticon_1').addEventListener('mouseout',function(){removeHeart(1);}, false);
  document.getElementById('hearticon_2').addEventListener('mouseout',function(){removeHeart(2);}, false);
  document.getElementById('hearticon_3').addEventListener('mouseout',function(){removeHeart(3);}, false);
  document.getElementById('hearticon_4').addEventListener('mouseout',function(){removeHeart(4);}, false);
  document.getElementById('hearticon_5').addEventListener('mouseout',function(){removeHeart(5);}, false);
  document.getElementById('hearticon_6').addEventListener('mouseout',function(){removeHeart(6);}, false);
  document.getElementById('hearticon_7').addEventListener('mouseout',function(){removeHeart(7);}, false);
  document.getElementById('hearticon_8').addEventListener('mouseout',function(){removeHeart(8);}, false);
  document.getElementById('hearticon_9').addEventListener('mouseout',function(){removeHeart(9);}, false);
  document.getElementById('hearticon_10').addEventListener('mouseout',function(){removeHeart(10);}, false);
  document.getElementById('skullicon_0').addEventListener('mouseout',function(){removeSkull(0);}, false);
  document.getElementById('skullicon_1').addEventListener('mouseout',function(){removeSkull(1);}, false);
  document.getElementById('skullicon_2').addEventListener('mouseout',function(){removeSkull(2);}, false);
  document.getElementById('skullicon_3').addEventListener('mouseout',function(){removeSkull(3);}, false);
  document.getElementById('skullicon_4').addEventListener('mouseout',function(){removeSkull(4);}, false);
  document.getElementById('skullicon_5').addEventListener('mouseout',function(){removeSkull(5);}, false);
  document.getElementById('skullicon_6').addEventListener('mouseout',function(){removeSkull(6);}, false);
  document.getElementById('skullicon_7').addEventListener('mouseout',function(){removeSkull(7);}, false);
  document.getElementById('skullicon_8').addEventListener('mouseout',function(){removeSkull(8);}, false);
  document.getElementById('skullicon_9').addEventListener('mouseout',function(){removeSkull(9);}, false);
  document.getElementById('skullicon_10').addEventListener('mouseout',function(){removeSkull(10);}, false);
  document.getElementById('hearticon_0').addEventListener('click',function(){clickHeart(0);}, false);
  document.getElementById('hearticon_1').addEventListener('click',function(){clickHeart(1);}, false);
  document.getElementById('hearticon_2').addEventListener('click',function(){clickHeart(2);}, false);
  document.getElementById('hearticon_3').addEventListener('click',function(){clickHeart(3);}, false);
  document.getElementById('hearticon_4').addEventListener('click',function(){clickHeart(4);}, false);
  document.getElementById('hearticon_5').addEventListener('click',function(){clickHeart(5);}, false);
  document.getElementById('hearticon_6').addEventListener('click',function(){clickHeart(6);}, false);
  document.getElementById('hearticon_7').addEventListener('click',function(){clickHeart(7);}, false);
  document.getElementById('hearticon_8').addEventListener('click',function(){clickHeart(8);}, false);
  document.getElementById('hearticon_9').addEventListener('click',function(){clickHeart(9);}, false);
  document.getElementById('hearticon_10').addEventListener('click',function(){clickHeart(10);}, false);
  document.getElementById('skullicon_0').addEventListener('click',function(){clickSkull(0);}, false);
  document.getElementById('skullicon_1').addEventListener('click',function(){clickSkull(1);}, false);
  document.getElementById('skullicon_2').addEventListener('click',function(){clickSkull(2);}, false);
  document.getElementById('skullicon_3').addEventListener('click',function(){clickSkull(3);}, false);
  document.getElementById('skullicon_4').addEventListener('click',function(){clickSkull(4);}, false);
  document.getElementById('skullicon_5').addEventListener('click',function(){clickSkull(5);}, false);
  document.getElementById('skullicon_6').addEventListener('click',function(){clickSkull(6);}, false);
  document.getElementById('skullicon_7').addEventListener('click',function(){clickSkull(7);}, false);
  document.getElementById('skullicon_8').addEventListener('click',function(){clickSkull(8);}, false);
  document.getElementById('skullicon_9').addEventListener('click',function(){clickSkull(9);}, false);
  document.getElementById('skullicon_10').addEventListener('click',function(){clickSkull(10);}, false);
  document.getElementById('sorticon_recent').addEventListener('mouseover',showNew);
  document.getElementById('sorticon_recent').addEventListener('mouseout',removeNew);
  document.getElementById('sorticon_comments').addEventListener('mouseover',showComments);
  document.getElementById('sorticon_comments').addEventListener('mouseout',removeComments);
  document.getElementById('sorticon_hot').addEventListener('mouseover',showHot);
  document.getElementById('sorticon_hot').addEventListener('mouseout',removeHot);
  document.getElementById('sorticon_mostadds').addEventListener('mouseover',showBest);
  document.getElementById('sorticon_mostadds').addEventListener('mouseout',removeBest);
  document.getElementById('sorticon_worst').addEventListener('mouseover',showWorst);
  document.getElementById('sorticon_worst').addEventListener('mouseout',removeWorst);
  document.getElementById('navcanvas').addEventListener('mouseover',noHover);
  document.getElementById('songcanvas').addEventListener('mouseover',noHover);
  document.getElementById('1').addEventListener('mouseover',eatFood);
  document.getElementById('2').addEventListener('mouseover',eatFood);
  document.getElementById('3').addEventListener('mouseover',eatFood);
  document.getElementById('4').addEventListener('mouseover',eatFood);
  document.getElementById('5').addEventListener('mouseover',eatFood);
  document.getElementById('6').addEventListener('mouseover',eatFood);
  document.getElementById('7').addEventListener('mouseover',eatFood);
  document.getElementById('8').addEventListener('mouseover',eatFood);
  document.getElementById('9').addEventListener('mouseover',eatFood); 
  document.getElementById('hiddenslot_1').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_2').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_3').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_4').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_5').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_6').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_7').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_8').addEventListener('mouseout',removeHover);
  document.getElementById('hiddenslot_9').addEventListener('mouseout',removeHover);
  document.getElementById('carouselbox').addEventListener('click',moveCarousel);
  document.getElementById('carouselright').addEventListener('click',moveCarouselRight);
  function addHeart(iconname) {
    document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/heart_2px_red.png)'});
  }
  function addSkull(iconname) {
    document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/skull_2px_black.png)'});
  }
  function removeHeart(i) {
    var iconname = 'hearticon_' + i;
    var clickedname = 'heartclicked_' + i;
    var heartclicked = document.getElementById(clickedname).getValue();
    if (heartclicked == '0') {
      document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/heart_2px.png)'});
    }
  }
  function removeSkull(i) {
    var iconname = 'skullicon_' + i;
    var clickedname = 'skullclicked_' + i;
    var skullclicked = document.getElementById(clickedname).getValue();
    if (skullclicked == '0') {
      document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/skull_2px.png)'});
    }
  }
  function clickHeart(i) {
    var iconname = 'hearticon_' + i;
    var clickedname = 'heartclicked_' + i;
    var heartconfirm = 'heartconfirm_' + i;
    var heartclicked = document.getElementById(clickedname).getValue();
    var numberAdds = document.getElementById('dailyadds').getValue();
    var ajax = new Ajax();  
    ajax.responseType = Ajax.FBML;  
    ajax.requireLogin = true;  
    var url = 'http://apps.facebook.com/famegame/search.php';
    if (heartclicked == '0') {
      numberAdds++;
      document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/heart_2px_red.png)'});
      document.getElementById(clickedname).setValue('1');    
      ajax.post('http://thedreamfiles.com/fame_process.php?heartclicked=1'); 
      document.getElementById(heartconfirm).setStyle({display: 'block'});
      fadeOut(heartconfirm);
      new Dialog().showChoice('Important Dialog', 'HEY', 'Okay', 'Nevermind');
    }
    if (heartclicked == '1') {
      /* document.getElementById(heartconfirm).setStyle({opacity: '1.0'});
      clearInterval(heartInterval);
      var opac = document.getElementById(heartconfirm).getStyle('opacity');
      document.getElementById('beans').setValue(opac);
      numberAdds--;
      document.getElementById(clickedname).setValue('0');    
      document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/heart_2px.png)'});
      document.getElementById(heartconfirm).setStyle({display: 'none'}); */
    }
    document.getElementById('dailyadd').setTextValue(numberAdds);
    document.getElementById('dailyadds').setValue(numberAdds);
    // document.getElementById('beans').setValue(numberAdds);
  }
  function clickSkull(i) {
    var iconname = 'skullicon_' + i;
    var clickedname = 'skullclicked_' + i;
    var skullclicked = document.getElementById(clickedname).getValue();
    var numberAdds = document.getElementById('dailyskulls').getValue();
    if (skullclicked == '0') {
      numberAdds++;
      document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/skull_2px_black.png)'});
      document.getElementById(clickedname).setValue('1');    
    }
    if (skullclicked == '1') {
      numberAdds--;
      document.getElementById(clickedname).setValue('0');    
      document.getElementById(iconname).setStyle({background: 'url(http://thedreamfiles.com/fameimg/skull_2px.png)'});
    }
    document.getElementById('dailyskull').setTextValue(numberAdds);
    document.getElementById('dailyskulls').setValue(numberAdds);
  }
  function showNew(e) {
    document.getElementById('hiddenicon_recent').setStyle({display: 'block'});
    document.getElementById('staricon_recent').setStyle({display: 'block'});
  }
  function removeNew(e) {
    document.getElementById('hiddenicon_recent').setStyle({display: 'none'});
    document.getElementById('staricon_recent').setStyle({display: 'none'});
  }
  function showComments(e) {
    document.getElementById('hiddenicon_comments').setStyle({display: 'block'});
    document.getElementById('staricon_comments').setStyle({display: 'block'});
  }
  function removeComments(e) {
    document.getElementById('hiddenicon_comments').setStyle({display: 'none'});
    document.getElementById('staricon_comments').setStyle({display: 'none'});
  }
  function showHot(e) {
    document.getElementById('hiddenicon_hot').setStyle({display: 'block'});
    document.getElementById('staricon_hot').setStyle({display: 'block'});
  }
  function removeHot(e) {
    document.getElementById('hiddenicon_hot').setStyle({display: 'none'});
    document.getElementById('staricon_hot').setStyle({display: 'none'});
  }
  function showBest(e) {
    document.getElementById('hiddenicon_mostadds').setStyle({display: 'block'});
    document.getElementById('staricon_mostadds').setStyle({display: 'block'});
  }
  function removeBest(e) {
    document.getElementById('hiddenicon_mostadds').setStyle({display: 'none'});
    document.getElementById('staricon_mostadds').setStyle({display: 'none'});
  }
  function showWorst(e) {
    document.getElementById('hiddenicon_worst').setStyle({display: 'block'});
    document.getElementById('staricon_worst').setStyle({display: 'block'});
  }
  function removeWorst(e) {
    document.getElementById('hiddenicon_worst').setStyle({display: 'none'});
    document.getElementById('staricon_worst').setStyle({display: 'none'});
  }
  function fadeOut(elementID) {
    var opac = document.getElementById(elementID).getStyle('opacity');
    heartInterval = setInterval(function(){setOpacity(elementID)}, 200);
  }
  function setOpacity(elementID) {
    var opac = document.getElementById(elementID).getStyle('opacity');
    if (opac == 0) {
      clearInterval(heartInterval);
      heartInterval = null;
    }
    if (opac != 0) {
      opac = opac - 0.1;
    }
    // document.getElementById('beans').setValue(opac);
    document.getElementById(elementID).setStyle({opacity: opac});
  }
  function moveCarousel(e) {
    if (carouselmax < 9) {
      carouselmax++;
    }
    j = carouselmax - 5;
    document.getElementById(carouselmax).setStyle({display: 'block'});
    document.getElementById(j).setStyle({display: 'none'});
  }
  function moveCarouselRight(e) {
    j = carouselmax - 5;
    document.getElementById(carouselmax).setStyle({display: 'none'});
    document.getElementById(j).setStyle({display: 'block'});
    carouselmax--;
  }
  function eatFood(e) {
    j = carouselmax - 4;
    k = carouselmax + 1;
    for (i=1; i<9; i++) {
      var hiddenId = 'hiddenslot_' + i; 
      document.getElementById(hiddenId).setStyle({display: 'none'});
    }
    for (i=j; i<k; i++) {
      document.getElementById(i).setStyle({display: 'block'});
    }
    this.setStyle({display: 'none'});
    var idNumber = this.getId();
    var hiddenId = 'hiddenslot_' + idNumber;
    document.getElementById(hiddenId).setStyle({display: 'block'});
  }
  function noHover(e) {
    j = carouselmax - 4;
    k = carouselmax + 1;
    for (i=1; i<9; i++) {
      var hiddenId = 'hiddenslot_' + i; 
      document.getElementById(hiddenId).setStyle({display: 'none'});
    }
    for (i=j; i<k; i++) {
      document.getElementById(i).setStyle({display: 'block'});
    }
  }
  function removeHover(e) {
    j = carouselmax - 4;
    k = carouselmax + 1;
    this.setStyle({display: 'none'});
    for (i=j; i<k; i++) {
      document.getElementById(i).setStyle({display: 'block'});
    }
    /* var idNumber = this.getId();
    var hiddenId = idNumber.charAt(11);
    document.getElementById(hiddenId).setStyle({display: 'block'}); */
  }
  </script>

  <?php
  /* print_r($_POST);
  print 'get:';
  print_r($_GET); */
  // print '<input type="text" value="blah" id="beans"/>';
  // print '<div id="poop" style="width: 30px; height: 30px; background: red"></div>';
while ($array = mysql_fetch_row($query)) {
  print '<input type="hidden" id="heartclicked_' . $i . '" value="0"/>';
  print '<input type="hidden" id="skullclicked_' . $i . '" value="0"/>';
  $mp3 = $array[0];
  $name = $array[1];
  $artist = $array[2];
  $album = $array[3];
  $listenlink = $array[4];
  $ituneslink = $array[5];
  print $ituneslink;
  $opacity = 1;
  /* if ($listenlink == NULL || $listenlink == ' ') {
    $opacity = 0.4;
  } */
  $title = $name;
  if (strlen($name) > 30) {
    $title = substr($name, 0, 30) . '...';
  }
  if ($i%2 == 0) {
    print '<div class="song">';
  }
  else {
    print '<div class="song" style="background-color: #F0F7FB">';
  }
  print '<div class="songlink"><img src="http://thedreamfiles.com/images/icons_nightlife/PNGs/live-music_32.png" style="opacity: ' . $opacity . '"/></div>';
  print '<div class="songtext">';
  print '<input type="hidden" value="songid" id="songid_' . $i . '"/>';
  print '<div class="songname">' . $title . '<img class="flame" src="http://thedreamfiles.com/fameimg/flame.png"/></div>';
  print '<div class="songartist">' . $artist . '</div>';
  /* if ($album != NULL && $album != ' ') {
    print '<div class="songalbum"> * ' . $album . '</div>';
  } */
  print '<div class="songadds"><span class="plus">+</span><span class="songstat">936</span><span class="statlabel">Today</span></div>';
  print '<div class="songbuttons"><div class="songadd_wrapper"><div class="songadd_corner1"/><div class="songadd_corner2"/><div class="songadd">WATCH</div><div class="songadd_corner2"/><div class="songadd_corner1"/></div><div class="songprofile_wrapper"><div class="songprofile_corner1"/><div class="songprofile_corner2"/><div class="songprofile">COMMENT</div><div class="songprofile_corner2"/><div class="songprofile_corner1"/></div><div class="songshare_wrapper"><div class="songshare_corner1"/><div class="songshare_corner2"/><div class="songshare">WALL</div><div class="songshare_corner2"/><div class="songshare_corner1"/></div>';
  // print '<div class="songbuy_wrapper"><div class="songbuy_corner1"/><div class="songbuy_corner2"/><div class="songbuy">BUY</div><div class="songbuy_corner2"/><div class="songbuy_corner1"/></div>';
  print '</div>';
  print '</div>';
  if ($mp3 != NULL && $mp3 != ' ') {
    print '<div class="songmp3"><div class="songmp3_corner1"/><div class="songmp3_corner2"/>';
    if ($i%2 == 0) {
      print '<div class="songmp3_inner">';
    }
    else {
      print '<div class="songmp3_inner" style="background-color: white">';
    }
    print '<fb:mp3 src="' . $mp3 . '" title="' . $name . '" artist="' . $artist . '" album="' . $album . '" width="35"/></div><div class="songmp3_corner2"/><div class="songmp3_corner1"/></div>';
    print '<div class="songnumbers">';
    print '<div class="songadds_all"><div class="songadds"><span class="statplus">+</span><span class="songstat">4483836</span><span class="statlabel">Adds</span></div></div>';
    /* print '<div class="songartist">4 comments</div>'; */
    print '<div class="songicons_green"><div class="songplus_wrapper"><form id="heartform"><a id="hearticon_' . $i . '" class="hearticon" style="background: url(http://thedreamfiles.com/fameimg/heart_2px.png)" /></form></div>';
    print '<div class="songplus_wrapper"><form id="skullform"><a id="skullicon_' . $i . '" class="skullicon"/></form></div>';
    print '<div class="heartconfirm" id="heartconfirm_' . $i . '" style="display: none; opacity: 1;">Song picked!</div>';
    /* print '<div class="songplus_wrapper"><a class="buyicon" href=""/></div>'; */
    print '</div></div>';
    /* print '<div class="arrowicon"></div>'; */
  }
  print '</div>';
  $i++;
}

print '</div>';

?>

